<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>blmc_robots: Homing (Joint Position Calibration)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">blmc_robots
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('homing.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Homing (Joint Position Calibration) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>What is "Homing" and Why is it Needed?</h2>
<p>When using relative encoders (like the quadrature encoders, we are using), we only get relative position changes (e.g. "motor moved by 13 degree"). By accumulating these changes, the position can be computed. However, when turning the robot on, the motor controller does not know the absolute position of the motor so it just defines the current position to be zero. This means that while the position is consistent while the robot is running, the same physical position can get different position values when the robot is turned off in between.</p>
<p>To solve this problem, the so called "homing" is performed in the beginning when turning the robot on. The idea is to search for a fixed physical position that can always be found, independent of where the joint is located when turned on (e.g. by having a switch that is triggered when the joint gets at that position). Once this "home position" is found, it can be set as zero position. This way, the same physical position will always correspond to the same position value, even if the robot is turned off between runs.</p>
<h2>How is the Homing Implemented for the BLMC Robots?</h2>
<p>In the <code>BlmcJointModule[s]</code> class, the following procedure is implemented:</p>
<ol type="1">
<li>From the current position move slowly in one direction (depending on parameters) until the next occurrence of the encoder index is reached.</li>
<li>Set this position as home position.</li>
<li>Set the zero position to home_position + home_offset.</li>
</ol>
<p>The <em>encoder index</em> is a special tick on the encoder wheel that appears only once per motor revolution. This means once the encoder index is found, the absolute position of the motor is known. However, there is typically a gear box so that multiple motor revolutions are needed for one joint revolution. So while the motor position is now known, the absolute position of the joint is still unknown as there are multiple occurrences of the encoder index within the range of the joint.</p>
<p>To solve this issue, it needs to be ensured that the "correct" encoder index is found. For robots with joint end-stops (e.g. the Finger robot) this is done by first moving in one direction until the end-stop is reached (detected by waiting for the velocity to become zero). Then the encoder index search is started from the end-stop position, thus guaranteeing that always the same index is found. For robots without end-stops (e.g. Solo) this can be solved by first moving the robot manually to a defined position before starting the homing.</p>
<h3>Home Position vs Zero Position â€“ Meaning of the Home Offset</h3>
<p>The home position is typically given by the mechanics (e.g. based on where the encoder index is located) and can not be influenced by the user. This position is often not the one where the user wants to have the zero position. To place the zero at a different position, the "home offset" parameter can be used. Once the home position is found, the zero is set to </p><pre class="fragment">zero_position = home_position + home_offset
</pre><p>This means, the zero can be placed wherever is best for the application by simply setting the home offset accordingly.</p>
<h2>How to Determine the Home Offset</h2>
<p>To determine the desired home offset value (e.g. when setting up a new robot), simply follow these steps:</p>
<ol type="1">
<li>First set the home offset to zero.</li>
<li>Start the robot and perform the homing.</li>
<li>Manually move the robot to the desired zero position and print the position of the joints (after homing these positions are now relative to the home position).</li>
<li>Set the joint positions of the desired zero position as home offset.</li>
</ol>
<p>When restarting now, the actual zero position after homing should be at the desired one. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
